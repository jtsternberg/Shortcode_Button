window.wp_sc_buttons=window.wp_sc_buttons||{},function(window,document,$,wp,QTags,l10n,btns,undefined){"use strict";if(l10n){var $c={};btns.qt={};var normalizeContent=function(content){return"<p>"===(content=content.trim()).substr(content.length-3)&&(content=content.substr(0,content.length-3).trim()),"<p>"!==content.substring(0,3)&&"</p>"===content.substr(content.length-4)&&(content="<p>"+content),content},removeQTagsButton=function(evt,ed){var id;if("sccontent"===ed.id&&btns.qt)for(id in btns.qt)ed.toolbar.removeChild(QTags.getInstance("sccontent").getButtonElement(id)),delete ed.theButtons[id]};btns.log=function(){btns.log.history=btns.log.history||[],btns.log.history.push(arguments),window.console&&window.console.log(Array.prototype.slice.call(arguments))};var Button=function(params){var btn={originalEditor:"",params:params,values:!1,isVisual:!1,editMode:!1,postID:0,content:"",givenContent:"",mceView:{},$:{}},cached=!1;return btn.cache=function(){cached||(btn.$.wrap=$(document.getElementById(params.slug+"-form")),btn.$.form=!!btn.$.wrap.length&&btn.$.wrap.find("form"),btn.$.editor=!!btn.$.wrap.length&&btn.$.form.find(".wp-editor-area").first(),btn.$.editor=!!btn.$.editor.length&&btn.$.editor,btn.postID=$("#post_ID").val()||0,cached=!0)},btn.close=function(){btn.$.form&&(btn.$.form.trigger("reset"),btn.$.form.find('[class^="cmb-row cmb-type-"]').trigger("shortcode_button:clear"),btn.$.form.find(".cmb-row.cmb-repeat-group-wrap").trigger("shortcode_button:clear")),$(document).off("keyup",btn.keyup),$c.modal.off("click",".scb-insert",btn.insert),$c.wrap.removeClass("scbshow")},btn.insert=function(){var ajaxData={fields:btn.$.form?btn.$.form.serialize():{},content:btn.shortcodeContent(),action:"wp_sc_form_process_"+params.slug},formFail=function(response){btns.log("response failure",response),btns.log("ajaxurl",ajaxurl),btns.log("fields",ajaxData.fields),btns.log("buttonParams",params),btn.close()};$.post(ajaxurl,ajaxData,function(response){response.success?btn.insertCallback(response.data):formFail(response)}).fail(formFail)},btn.shortcodeContent=function(){var content="";if(btn.$.editor&&(content=btn.$.editor.val(),btn.$.editor.parents(".wp-editor-wrap").hasClass("tmce-active"))){var editor=window.tinymce.get(btn.$.editor.attr("id"));editor&&(content=editor.getContent())}return content},btn.getSelectedText=function(){if(btn.editMode)return btn.content;if(btn.isVisual&&window.tinymce.activeEditor)return window.tinymce.activeEditor.selection.getContent();if(!btn.canvas)return"";if(btn.canvas.focus(),document.selection)return document.selection.createRange().text;var startPos=btn.canvas.selectionStart,endPos=btn.canvas.selectionEnd;return startPos!==endPos?btn.canvas.value.substring(startPos,endPos):""},btn.buildShortCode=function(scparams){var selectedContent=btn.getSelectedText(),newContent="";scparams.sc_content&&(scparams.sccontent=scparams.sc_content,delete scparams.sc_content),scparams.sccontent&&(btn.givenContent=newContent=btn.content=scparams.sccontent,delete scparams.sccontent),btn.givenContent&&(btn.givenContent=normalizeContent(btn.givenContent));var options={tag:params.slug,attrs:scparams,type:params.include_close?"closed":"single",content:btn.params.mceView?newContent:selectedContent+newContent};return new wp.shortcode(options).string()},btn.insertCallback=function(shortcode_params){var shortcode=btn.buildShortCode(shortcode_params);shortcode&&(btn.editMode?btn.editMode(shortcode):btn.isVisual&&btns.visualmode[params.slug]?btns.visualmode[params.slug].execCommand("mceInsertContent",0,shortcode):(window.wpActiveEditor=btn.originalEditor,QTags.insertContent(shortcode)),$c.body.trigger("shortcode_button:insert",{btn:btn,inserted:shortcode}),btn.close())},btn.initModal=function(){btn.$.wrap.length&&($c.modal.addClass(params.modalClass).css({height:params.modalHeight,width:params.modalWidth}),$c.modal.find(".scb-title").text(params.button_tooltip),$c.modal.find(".scb-cancel").text(params.l10ncancel),$c.modal.find(".scb-insert").text(btn.editMode?params.l10nupdate:params.l10ninsert),btn.maybePopulate())},btn.maybePopulate=function(){if(btn.values)return btn.triggerPopulation(btn.values),void(btn.values=!1);var attrs={},has=!1;if(params.cmb&&params.cmb.fields){var field,i;for(i=0;i<params.cmb.fields.length;i++)(field=params.cmb.fields[i]).default&&field.id&&(has=!0,attrs[field.id]=field.default)}has&&btn.triggerPopulation(attrs)},btn.triggerPopulation=function(attrs){$.each(attrs,function(name){btn.$.form.find('[name="'+name+'"], [name="'+name+'[]"]').trigger("shortcode_button:populate",{btn:btn,attrs:attrs,name:name})}),btn.$.editor&&btn.$.editor.trigger("shortcode_button:populate",{btn:btn,attrs:attrs,name:btn.$.editor.attr("name"),type:"wysiwyg"})},btn.keyup=function(evt){13===evt.keyCode&&(evt.preventDefault(),btn.insert()),27===evt.keyCode&&btns.close()},btn.openModal=function(){btn.originalEditor=window.wpActiveEditor,btns.open(btn.$.wrap),$c.modal.one("click",".scb-insert",btn.insert),$(document).on("keyup",btn.keyup)},btn.click=function(isVisual,canvas){if("function"==typeof isVisual?(btn.editMode=isVisual,isVisual=!0,btn.isVisual=!0):(btn.isVisual=!0===isVisual,btn.isVisual||(btn.editMode=!1)),btn.cache(),btn.canvas=canvas||"",$c.body.trigger("shortcode_button:click",{btn:btn}),!btn.$.wrap.length)return btn.insert();btn.initModal(),btn.openModal()},btn.params.mceView&&(btn.mceView={action:"scb_parse_shortcode",state:[],sc:!1},btn.mceView.initialize=function(){var that=this;btn.mceView.sc=that.shortcode,that.url&&(that.loader=!1,that.shortcode=wp.media.embed.shortcode({url:that.text})),btn.givenContent&&(that.shortcode.content=btn.givenContent),btn.content=that.shortcode.content,wp.ajax.post(that.action,{post_ID:btn.postID,type:that.shortcode.tag,shortcode:that.shortcode.string()}).done(function(response){that.render(response)}).fail(btn.mceView.ajaxFail)},btn.mceView.ajaxFail=function(response){btns.log("response fail",response),btn.mceView.url?btn.mceView.removeMarkers():btn.mceView.setError(response.message||response.statusText,"admin-media")},btn.mceView.edit=function(text,update){this.shortcode.attrs&&this.shortcode.attrs.named&&(btn.content=this.shortcode.content,btn.values=this.shortcode.attrs.named,btn.cache(),$c.modal.find(".scb-insert").text(params.l10nupdate),btn.click(update))}),btn};btns.init=function(){for(var button,i=l10n.length-1;i>=0;i--)button=new Button(l10n[i]),QTags.addButton(button.params.slug,button.params.qt_button_text,button.click),btns.qt[button.params.slug]=button,button.params.mceView&&wp.mce.views.register(button.params.slug,button.mceView),$c.body.trigger("shortcode_button:button_init_complete_"+button.params.slug,{btn:button});$c.body.trigger("shortcode_button:buttons_init_complete")},btns.open=function(el){$c.body.trigger("shortcode_button:open",el)},btns.close=function(){$c.body.trigger("shortcode_button:close")},btns.clearFields=function(evt){var $this=$(evt.target),classes=$this.attr("class");switch($this.hasClass("cmb-repeat-group-wrap")?"group":classes.replace("cmb-row cmb-type-","").split(" ")[0]){case"text":case"text-medium":case"text-small":return $this.find('[type="text"]').val("");case"file":return $this.find(".cmb2-upload-file-id").val(""),$this.find(".cmb2-media-status").html("");case"file-list":return $this.find(".cmb2-media-status").html("");case"colorpicker":return $this.find(".wp-picker-clear").click();case"group":return $this.find(".cmb-repeatable-grouping:not(:first-child)").remove()}},btns._populateFields=function(evt,_data){var $field=$(evt.target),classes=$field.parents('[class^="cmb-row cmb-type-"]').attr("class").replace("cmb-row cmb-type-","").split(" "),data=$.extend(!0,{},_data),btn=data.btn;if(data.type=classes[0],data.value=data.attrs[data.name]?data.attrs[data.name]:"",btn.populateField)return btn.populateField($field,data);switch(data.type){case"text":case"text-medium":case"text-small":case"textarea":case"file":return $field.val(data.value);case"colorpicker":return $field.wpColorPicker("color",data.value);case"multicheck":case"multicheck_inline":case"multicheck-inline":if(data.value){data.value=data.value.replace(/\|~/g,"[").replace(/~\|/g,"]").replace(/\'/g,'"');try{data.value=$.parseJSON(data.value)}catch(e){data.value=[data.value]}}else data.value=[data.value];return $field.prop("checked",-1!==$.inArray($field.val(),data.value));case"radio":case"radio_inline":case"radio-inline":return $field.prop("checked",data.value===$field.val());case"select":return $field.find("option").prop("selected",!1),$field.find('option[value="'+data.value+'"]').prop("selected",!0);case"wysiwyg":btn.$.editor.val(btn.content);var editor=window.tinymce.get(btn.$.editor.attr("id"));return void(editor&&btn.content&&editor.setContent(normalizeContent(btn.content)))}},btns.jQueryInit=function(){$c.body=$(document.body),btns.init(),$c.body.on("click","#scb-overlay, .scb-close, .scb-cancel",btns.close).on("shortcode_button:clear",btns.clearFields).on("shortcode_button:populate",btns._populateFields).on("shortcode_button:close",function(){$.each(btns.qt,function(slug,btn){btn.close()}),$c.wrap.removeClass("scbshow")}).on("shortcode_button:open",function(evt,el){$c.wrap.addClass("scbshow"),el&&($c.forms.removeClass("scbshow"),$(el).addClass("scbshow"));var width=$c.modal.outerWidth(),height=$c.modal.outerHeight(),fromTop=window.innerHeight>height+.3*window.innerHeight?.15:.035,css={top:window.scrollY+window.innerHeight*fromTop};window.innerWidth>width&&(css.left=(window.innerWidth-width)/2),$c.modal.css(css).trigger("focus")}),$c.wrap=$(document.getElementById("scb-wrap")),$c.modal=$(document.getElementById("scb-modal")),$c.forms=$(".scb-form-wrap"),$c.body.trigger("shortcode_button:jquery_init_complete")},$(btns.jQueryInit).on("quicktags-init",removeQTagsButton)}}(window,document,jQuery,wp,QTags,shortcodeButtonsl10n,wp_sc_buttons);