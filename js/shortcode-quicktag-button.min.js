window.wp_sc_buttons=window.wp_sc_buttons||{},function(window,document,$,wp,QTags,l10n,btns,undefined){"use strict";if(l10n){var $c={};btns.qt={},btns.log=function(){btns.log.history=btns.log.history||[],btns.log.history.push(arguments),window.console&&window.console.log(Array.prototype.slice.call(arguments))};var Button=function(params){var btn={params:params,isVisual:!1,editMode:!1,postID:0,content:"",mceView:{},$:{}},cached=!1;return btn.cache=function(){cached||(btn.$.wrap=$(document.getElementById(params.slug+"-form")),btn.$.form=btn.$.wrap.length?btn.$.wrap.find("form"):!1,btn.postID=$("#post_ID").val()||0,cached=!0)},btn.close=function(){btn.$.form&&(btn.$.form.trigger("reset"),btn.$.form.find('[class^="cmb-row cmb-type-"]').trigger("shortcode_button:clear")),$(document).off("keyup",btn.keyup),$c.modal.off("click",".scb-insert",btn.insert),$c.wrap.removeClass("scbshow")},btn.insert=function(){var ajaxData={fields:btn.$.form?btn.$.form.serialize():{},action:"wp_sc_form_process_"+params.slug},formFail=function(response){btns.log("response failure",response),btns.log("ajaxurl",ajaxurl),btns.log("fields",ajaxData.fields),btns.log("buttonParams",params),btn.close()};$.post(ajaxurl,ajaxData,function(response){response.success?btn.insertCallback(response.data):formFail(response)}).fail(formFail)},btn.getSelectedText=function(){if(btn.editMode)return btn.content;if(btn.isVisual&&window.tinymce.activeEditor)return window.tinymce.activeEditor.selection.getContent();if(!btn.canvas)return"";if(btn.canvas.focus(),document.selection)return document.selection.createRange().text;var startPos=btn.canvas.selectionStart,endPos=btn.canvas.selectionEnd;return startPos!==endPos?btn.canvas.value.substring(startPos,endPos):""},btn.buildShortCode=function(shortcode_params){var shortcode="["+params.slug,selected_text=btn.getSelectedText(),content="";return $.each(shortcode_params,function(key,value){"sc_content"===key?content=value:"object"==typeof value?$.each(value[0],function(key,value){shortcode+=" "+key+'="'+value+'"'}):shortcode+=" "+key+'="'+value+'"'}),shortcode+="]",(params.include_close||content)&&(shortcode=shortcode+selected_text+content+"[/"+params.slug+"]"),shortcode},btn.insertCallback=function(shortcode_params){var shortcode=btn.buildShortCode(shortcode_params);shortcode&&(btn.editMode?btn.editMode(shortcode):btn.isVisual&&btns.visualmode[params.slug]?btns.visualmode[params.slug].execCommand("mceInsertContent",0,shortcode):QTags.insertContent(shortcode),$c.body.trigger("shortcode_button:insert",{btn:btn,inserted:shortcode}),btn.close())},btn.initModal=function(){btn.$.wrap.length&&($c.modal.addClass(params.modalClass).css({height:params.modalHeight,width:params.modalWidth}),$c.modal.find(".scb-title").text(params.button_tooltip),$c.modal.find(".scb-cancel").text(params.l10ncancel),$c.modal.find(".scb-insert").text(btn.editMode?params.l10nupdate:params.l10ninsert))},btn.keyup=function(evt){13===evt.keyCode&&(evt.preventDefault(),btn.insert()),27===evt.keyCode&&btns.close()},btn.openModal=function(){btns.open(btn.$.wrap),$c.modal.one("click",".scb-insert",btn.insert),$(document).on("keyup",btn.keyup)},btn.click=function(isVisual,canvas){return"function"==typeof isVisual?(btn.editMode=isVisual,isVisual=!0,btn.isVisual=!0):btn.isVisual=!0===isVisual,btn.cache(),btn.canvas=canvas||"",$c.body.trigger("shortcode_button:click",{btn:btn}),btn.$.wrap.length?(btn.initModal(),void btn.openModal()):btn.insert()},btn.params.mceView&&(btn.mceView={action:"scb_parse_shortcode",state:[]},btn.mceView.initialize=function(){var that=this;that.url&&(that.loader=!1,that.shortcode=wp.media.embed.shortcode({url:that.text})),btn.content=that.shortcode.content,wp.ajax.post(that.action,{post_ID:btn.postID,type:that.shortcode.tag,shortcode:that.shortcode.string()}).done(function(response){that.render(response)}).fail(btn.mceView.ajaxFail)},btn.mceView.ajaxFail=function(response){btns.log("response fail",response),btn.mceView.url?btn.mceView.removeMarkers():btn.mceView.setError(response.message||response.statusText,"admin-media")},btn.mceView.edit=function(text,update){if(this.shortcode.attrs&&this.shortcode.attrs.named){btn.cache();var attrs=this.shortcode.attrs.named;btns.log("attrs",attrs,this.shortcode.attrs),$c.modal.find(".scb-insert").text(params.l10nupdate),btn.$.form.find('[class^="cmb-row cmb-type-"]').trigger("shortcode_button:populate",{btn:btn,attrs:attrs}),btn.click(update)}}),btn};btns.init=function(){for(var button,i=l10n.length-1;i>=0;i--)button=new Button(l10n[i]),QTags.addButton(button.params.slug,button.params.qt_button_text,button.click),btns.qt[button.params.slug]=button,button.params.mceView&&wp.mce.views.register(button.params.slug,button.mceView),$c.body.trigger("shortcode_button:button_init_complete_"+button.params.slug,{btn:button});$c.body.trigger("shortcode_button:buttons_init_complete")},btns.open=function(el){$c.body.trigger("shortcode_button:open",el)},btns.close=function(){$c.body.trigger("shortcode_button:close")},btns.clearFields=function(evt){var $this=$(evt.target),type=$this.attr("class").replace("cmb-row cmb-type-","").split(" ")[0];switch(type){case"file":return $this.find(".cmb2-upload-file-id").val(""),$this.find(".cmb2-media-status").html("");case"file-list":return $this.find(".cmb2-media-status").html("");case"colorpicker":return $this.find(".wp-picker-clear").click()}},btns._populateFields=function(evt,_data){var $field=$(evt.target),classes=$field.attr("class").replace("cmb-row cmb-type-","").split(" "),data=$.extend(!0,{},_data);return data.type=classes[0],data.name=classes[1].replace("cmb2-id-","").split(" ")[0],data.value=data.attrs[data.name]?data.attrs[data.name]:"",data.btn.populateField?data.btn.populateField($field,data):btns._populateField($field,data)},btns._populateField=function($field,data){switch(data.type){case"text":return $field.find("[name="+data.name+"]").val(data.value);case"radio":case"radio_inline":case"multicheck":return $field.find("[name="+data.name+"][checked]").removeAttr("checked"),$field.find("[name="+data.name+"][value="+data.value+"]").prop("checked",1)}},btns.jQueryInit=function(){$c.body=$(document.body),btns.init(),$c.body.on("click","#scb-overlay, .scb-close, .scb-cancel",btns.close).on("shortcode_button:clear",btns.clearFields).on("shortcode_button:populate",btns._populateFields).on("shortcode_button:close",function(){$.each(btns.qt,function(slug,btn){btn.close()}),$c.wrap.removeClass("scbshow")}).on("shortcode_button:open",function(evt,el){$c.wrap.addClass("scbshow"),el&&($c.forms.removeClass("scbshow"),$(el).addClass("scbshow"));var width=$c.modal.outerWidth(),height=$c.modal.outerHeight(),fromTop=window.innerHeight>height+.3*window.innerHeight?.15:.035,css={top:window.scrollY+window.innerHeight*fromTop};window.innerWidth>width&&(css.left=(window.innerWidth-width)/2),$c.modal.css(css).trigger("focus")}),$c.wrap=$(document.getElementById("scb-wrap")),$c.modal=$(document.getElementById("scb-modal")),$c.forms=$(".scb-form-wrap"),$c.body.trigger("shortcode_button:jquery_init_complete")},$(btns.jQueryInit)}}(window,document,jQuery,wp,QTags,shortcodeButtonsl10n,wp_sc_buttons);